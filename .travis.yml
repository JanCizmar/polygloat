language: java
jdk: openjdk14

services:
  - docker

script:
  - ./gradlew build
  - ./gradlew buildProdDocker
  - docker run -d -p8082:8080 --name app polygloat/polygloat
  - cd clientapp
  - npm install
  - 'until docker logs --since 5m app | grep -m 1 "started on port(s): 8080"; do : ; done'
  - npx cypress run --env host=http://localhost:8082 --spec cypress/integration/login.spec.js
